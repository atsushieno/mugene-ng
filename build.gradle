
allprojects {
    repositories {
        mavenLocal()
        google()
        mavenCentral()
        jcenter() // kotlinx-nodejs requires this...!
        maven { url "https://jitpack.io" }
        maven {
            url "https://maven.pkg.github.com/atsushieno/ktmidi"
            credentials {
                username = project.findProperty("gpr.user") ?: System.getenv("USERNAME")
                password = project.findProperty("gpr.token") ?: System.getenv("GITHUB_TOKEN")
            }
        }
    }
}

// This is a workaround for https://youtrack.jetbrains.com/issue/KT-44884
configurations.matching { it.name != "kotlinCompilerPluginClasspath" }.all {
    resolutionStrategy.eachDependency {
        val version = requested.version
        if (requested.group == "org.jetbrains.kotlinx" &&
                requested.name.startsWith("kotlinx-coroutines") &&
                version != null && !version.contains("native-mt")
        ) {
            useVersion("$version-native-mt")
        }
    }
}

subprojects {
    apply plugin: "maven-publish"
    publishing {
        repositories {
            maven {
                name = "GitHubPackages"
                url = uri("https://maven.pkg.github.com/atsushieno/mugene-ng")
                credentials {
                    username = project.findProperty("gpr.user") ?: System.getenv("USERNAME")
                    password = project.findProperty("gpr.key") ?: System.getenv("GITHUB_TOKEN")
                }
            }
        }
    }
}
